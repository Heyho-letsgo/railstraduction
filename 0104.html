<span id="sites-page-title" dir="ltr">04 - Les modèles</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" class="sites-layout-name-one-column sites-layout-hbox" cellspacing="0"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><h2><a name="TOC-Models"></a>Models</h2><h2><a name="TOC-Dans-l-exercice-pr-c-dent-nous-avons-fait-vivre-l-application-en-utilisant-un-controller-et-une-view.-"></a><span style="font-size:10pt;font-weight:normal">Dans l'exercice précédent nous avons fait vivre <font face="arial, sans-serif">l'application</font> en utilisant un controller et une view.&nbsp;</span></h2><h2><a name="TOC-Dans-cet-exercice-nous-allons-porter-notre-attention-sur-le-model-dans-le-but-d-enregistrer-des-films-dans-la-base-de-donn-es."></a><span style="font-size:10pt;font-weight:normal">Dans cet exercice, nous allons porter notre attention sur le model dans le but d'enregistrer des films dans la base de données.</span></h2><h2><a name="TOC-Objectifs"></a>Objectifs</h2><ul><li><span style="font-size:10pt">généré un modèle Movie</span></li><li><span style="font-size:10pt">utiliser une migration pour créer une table movies dans la base de données</span></li><li><span style="font-size:10pt">créer trois films et les sauvegarder dans la table</span></li><li><span style="font-size:10pt">afficher les films de la table</span></li><li><span style="font-size:10pt">mettre à jour les attributs des films dans la table</span></li><li><span style="font-size:10pt">supprimer un film de la table</span></li></ul><div><br></div><div>A la fin nous aurons un modèle Movie qui peut create, read, update and delete (CRUD) des films dans la bases de données.<br></div><div><br></div><div><b><span>&nbsp;&nbsp; &nbsp;</span>1. </b>Générer le modèle Movies et sa migration<br><br>En Rails, un modèle est simplemennt une classe Ruby situé dans le répertoire app/model.&nbsp;</div><div><br></div><div>Le rôle d'un modèle est de fournir l'accès à des données au niveau de l'application et d'encapsuler la logique métier de l'application. OK POUR MOI C'EST PAS CLAIR<br><br><font color="#0000ff">The role of a model is to provide access to application-level data and encapsulate the application's business logic. Although it's not a requirement, most models in a Rails app are connected to an underlying database since that's where application data is typically stored.</font><br><br><br>Actuellement nous affichons un film uniquement par son titre en chaîne de caractère (string). A présent, nous voulons que notre film ai trois attributs: un titre, une autorisation, et son chiffre d'affaire (en euros). Nous afficherons les films dans la base de données avec les champs et types suivant:</div><br><b>name<span>&nbsp;&nbsp; &nbsp;<span>&nbsp;&nbsp; &nbsp;<span>&nbsp;&nbsp; &nbsp;<span>&nbsp;&nbsp; &nbsp;</span></span></span></span>type</b><br>titre<span>&nbsp;&nbsp; &nbsp;<span>&nbsp;&nbsp; &nbsp;<span>&nbsp;&nbsp; &nbsp;<span>&nbsp;&nbsp; </span></span></span></span>string<br>autorisation&nbsp;<span>&nbsp;&nbsp; &nbsp;</span>string<br>chiffre_affaire&nbsp;<span>&nbsp;</span>decimal<br><br>Pour faire cela nous avons besoin de créer une table dans la base de données pour enregistrer les films et aussi de définir un modèle Movies qui accédera à cette table.<div><br></div><div>Pour cela rails met à notre disposition un autre générateur.<br></div><br><b>1. </b>Juste pour avoir une idée de la façon d'utiliser ce générateur, tapez juste la ligne suivante à l'intérieur du répertoire flix.<div><br></div><div><div class="sites-codeblock sites-codesnippet-block"><font face="courier new, monospace"><code>rails generate model</code></font><br><div></div></div><br>Tout en haut de l'affichage vous verrez que ce générateur prend un nom de modèle suivi par une liste de champs et de type séparée par des crochets<br><br><font face="courier new, monospace">rails generate model NAME [field[:type][:index] field[:type][:index]] [options]</font><div><br></div><div>la commande affiche également la liste des types de champs suportés:</div><div><ul><li><span style="font-size:10pt">string</span></li><li><span style="font-size:10pt">text</span></li><li><span style="font-size:10pt">integer</span></li><li><span style="font-size:10pt">decimal</span></li><li><span style="font-size:10pt">float</span></li><li><span style="font-size:10pt">boolean</span></li><li><span style="font-size:10pt">binary</span></li><li><span style="font-size:10pt">date</span></li><li><span style="font-size:10pt">time</span></li><li><span style="font-size:10pt">datetime</span></li><li><span style="font-size:10pt">primary_key</span></li><li><span style="font-size:10pt">timestamp</span></li></ul><div><b>2.</b>&nbsp;A présent utilisons cette commande pour genérer un modèle nommé Movie (au singulier) avec les champs et les types ci-dessus.</div></div></div><div><br></div><div><font face="courier new, monospace">rails generate model movie titre:string autorisation:string chiffre_affaire:decimal</font></div><div><font face="courier new, monospace"><br></font></div><div><font face="arial, sans-serif"><b>3.</b> Ouvrez le fichier généré dans app/models/movie.rb and il devrait ressembler à ceci:</font></div><div><br></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><font face="courier new, monospace"><code>class Movie &lt; ActiveRecord::Base&nbsp;</code></font></div><font face="courier new, monospace"><code>end</code><br></font></div><br>C'est tout ce que nous avons!? Juste une classe (vide) Ruby ! Il n'y a pas d'attributs ou de méthode, pas même un commentaire. La seule partie intrigante est cette héritage de la classe ActiveRecord::Base . Croyez le ou non, c'est tout ce dont à besoin un modèle pour ce connecter à sa base de données.<div><br></div><div><b>4. </b>Le generator a aussi généré un fichier daté, de migration de base de données dans db/migrate/YYYYMMDDHHMMSS_create_movies.rb. Le&nbsp;YYYYMMDDHHMMSS est inclu dans le nom du fichier de sorte que la migration peut être conservée par ordre chronographique. Ouvrez ce fichier et vous devriez voir:<br><div><br></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><span style="font-size:10pt"><code>class CreateMovies &lt; ActiveRecord::Migration&nbsp;</code></span></div><div><code>&nbsp;<span>&nbsp;&nbsp;</span>def change&nbsp;</code></div><div><code>&nbsp;<span>&nbsp;&nbsp; &nbsp;</span>create_table :movies do |t|&nbsp;</code></div><div><code><span>&nbsp;&nbsp; &nbsp;<span>&nbsp;&nbsp; &nbsp;</span></span>&nbsp;t.string :titre&nbsp;</code></div><div><code>&nbsp;<span>&nbsp;&nbsp; &nbsp;<span>&nbsp;&nbsp; &nbsp;</span></span>t.string :autorisation&nbsp;</code></div><div><code>&nbsp;<span>&nbsp;&nbsp; &nbsp;<span>&nbsp;&nbsp; &nbsp;</span></span>t.decimal :chiffre_affaire&nbsp;</code></div><div><code>&nbsp;<span>&nbsp;&nbsp; &nbsp;<span>&nbsp;&nbsp; &nbsp;</span></span>t.timestamps&nbsp;</code></div><div><code>&nbsp;<span>&nbsp;&nbsp; &nbsp;</span>end&nbsp;</code></div><div><code>&nbsp;<span>&nbsp;&nbsp;</span>end&nbsp;</code></div><div><code>end&nbsp;</code></div><div></div></div><br><div>Pensez à la migration comme a une instruction pour modifier votre base de données.&nbsp;<br><br>Toute cette action se passe avec la methode change. C'est dans cette methode que nous "changeons" la base de données.&nbsp;</div><div><br></div><div>IL EST IMPORTANT DE NOTER QUE LE NOM DU MODEL EST SINGULIER ET QUE LE NOM DE LA TABLE EST PLURIEL</div><div><br></div><div>Ce fichier de migration fonctionnera quelque soient les bases de données utilisées&nbsp;<span style="font-size:10pt">SQLite, MySQL, PostgreSQL, Oracle.</span></div></div><div><span style="font-size:10pt"><br></span></div><h2><a name="TOC-2.-Lancer-la-migration"></a><font size="4">2. Lancer la migration</font></h2><div><font face="arial, sans-serif" size="2">Ok, nous avons généré les instructions (migrations) pour créer la table de la base de données, mais le générateur ne transfère pas les instructions à la &nbsp;base de données; Pour cela nous devons lancer (run) la migration.</font></div><div><b><br></b></div><div><b>1. </b>Mais quelle base de données sera modifiée quand nous lancerons la migration ? Regardez le fichier config/database.yml et vous verrez les choses suivantes...</div><div><br></div><div><pre style="margin-top:0px;margin-bottom:0px;padding:15px;border:1px solid rgb(198,195,186);font-family:Monaco,Lucida Console,monospace;line-height:20.15999984741211px;font-size:14px;vertical-align:baseline;border-top-left-radius:8px;border-top-right-radius:8px;border-bottom-right-radius:8px;border-bottom-left-radius:8px;color:rgb(127,117,103);background-color:rgb(224,221,213);overflow:auto">development:
  adapter: sqlite3
  database: db/development.sqlite3
  pool: 5
  timeout: 5000

test:
  adapter: sqlite3
  database: db/test.sqlite3
  pool: 5
  timeout: 5000

production:
  adapter: sqlite3
  database: db/production.sqlite3
  pool: 5
  timeout: 5000</pre></div><div><font size="4"><br></font></div><div><font face="arial, sans-serif" size="2">Le fichier YAML dit à Rails quelle base utiliser en fonction de l'environnement de fonctionnement: development, test ou production. Par défaut votre application Rails fonctionne dans&nbsp;l’environnement&nbsp;development.</font></div><div>On reviendra sur ça plus tard.</div><div><br></div><div>Notez que la base de données configurée par défaut est SQLite. SQLite est une base légère, mono utilisateur et qui fonctionne très bien en développement. Les bases de données SQLite sont stockées dans des fichiers dans <code>db/development.sqlite3</code>. (Ce fichier n'existe pas encore)</div><div><span style="font-size:10pt"><br></span></div><div><font size="2">Vous n'avez pas à vous soucier du fichier <code>database.ym</code>l à moins que vous soyez prêt à passer votre application en&nbsp;</font>environnement de production. Quand ce temps viendra, vous aurez besoin de changer les réglages à <code>production</code><font face="arial, sans-serif" size="2">&nbsp;pour utiliser une autre base comme MySQL, PostgreSQL, Oracle ou d'autres. Mais on parlera de ça plus tard.</font></div><div><font face="arial, sans-serif" size="2"><br></font></div><div><font face="arial, sans-serif" size="2">L'important à se souvenir est que nous n'avons pas besoin de configurer à présent la base de données.</font></div><div><font face="arial, sans-serif" size="2"><br></font></div><div><font size="2"><b style="font-family:arial,sans-serif">2.</b><font face="arial, sans-serif"> Maintenant lançons la migration. C'est une tache aisée que Rails automatise en utilisant l'utilitaire </font><font face="arial, sans-serif">rake</font><font face="arial, sans-serif" color="#000000">. Pour voir toute les taches que <code>rake</code> peut&nbsp;exécuter, lancez la commande.</font></font></div><div><font size="2"><font face="arial, sans-serif" color="#000000"><br></font></font></div><div><font size="2"><font face="arial, sans-serif" color="#000000"><div class="sites-codeblock sites-codesnippet-block"><code>rake -T db</code></div></font></font></div><div><br></div><div>Cette commande n'affiche que les fonction rake qui concerne db (base de données) .</div><div><br></div><div><div></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>andrew@pca:~/workspace/ror/traduction/flix$ rake -T db</code></div><div><code>rake db:create &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Create the database from DATABASE_URL or config/database.yml for the current Rails.env (use db:create:all to create all dbs in the config)</code></div><div><code>rake db:drop &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Drops the database using DATABASE_URL or the current Rails.env (use db:drop:all to drop all databases)</code></div><div><code>rake db:fixtures:load &nbsp; &nbsp; &nbsp; # Load fixtures into the current environment's database</code></div><div><code>rake db:migrate &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Migrate the database (options: VERSION=x, VERBOSE=false, SCOPE=blog)</code></div><div><code>rake db:migrate:status &nbsp; &nbsp; &nbsp;# Display status of migrations</code></div><div><code>rake db:rollback &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Rolls the schema back to the previous version (specify steps w/ STEP=n)</code></div><div><code>rake db:schema:cache:clear &nbsp;# Clear a db/schema_cache.dump file</code></div><div><code>rake db:schema:cache:dump &nbsp; # Create a db/schema_cache.dump file</code></div><div><code>rake db:schema:dump &nbsp; &nbsp; &nbsp; &nbsp; # Create a db/schema.rb file that can be portably used against any DB supported by AR</code></div><div><code>rake db:schema:load &nbsp; &nbsp; &nbsp; &nbsp; # Load a schema.rb file into the database</code></div><div><code>rake db:seed &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </code><code>&nbsp;# Load the seed data from db/seeds.rb</code></div><div><code>rake db:setup &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Create the database, load the schema, and initialize with the seed data (use db:reset to also drop the db first)</code></div><div><code>rake db:structure:dump &nbsp; &nbsp; &nbsp;# Dump the database structure to db/structure.sql</code></div><div><code>rake db:version &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Retrieves the current schema version n</code><span style="line-height:1;font-size:10pt"><code>umber</code></span></div><div><code>rake test:all:db &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Run tests quickly, but also reset db</code></div></div><div><br></div></div><div>A partir de la liste qui s'affiche on peut trouver la commande qui lance la migration...</div><div><br></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>rake db:migrate</code></div><div></div></div><br><div>Vous devriez avoir ceci à l'écran.</div><div><br></div><div><div></div></div><div class="sites-codeblock sites-codesnippet-block"><div><div><code>andrew@pca:~/workspace/ror/traduction/flix$ rake db:migrate</code></div><div><code>== 20140420172800 CreateMovies: migrating =====================================</code></div><div><code>-- create_table(:movies)</code></div><div><code>&nbsp; &nbsp;-&gt; 0.0016s</code></div><div><code>== 20140420172800 CreateMovies: migrated (0.0017s) ============================</code></div></div><div></div></div><div><br></div><div>Lancer la tache a exécuté les instructions de notre fichier de migration. La tache a parcourue tout les fichiers de migration dans le répertoire <code>db/migrate</code> et a lancé toutes les migrations qui n'avaient pas déjà été lancée. Dans notre cas, nous avons seulement un fichier de migration à lancer.</div><div>Pour lancer la migration, la méthode <code>change</code> de ce fichier de migration a été appelé, ce qui a permis de créer la table <code>movies</code>. &nbsp;</div><div><br></div><div><b>3. </b>Ensuite, vérifions le statuts de la migration en lançant la task<code> db:migrate:status</code></div><div><br></div><div><div class="sites-codeblock sites-codesnippet-block"><code>rake db:migrate:status</code></div></div><div><b><br></b></div><div>Vous devriez obtenir quelque chose de similaire à ça:</div><div><br></div><div><div></div></div><div class="sites-codeblock sites-codesnippet-block"><div><div><code>andrew@pca:~/workspace/ror/traduction/flix$ rake db:migrate:status</code></div><div><br></div><div><code>database: /home/andrew/workspace/ror/traduction/flix/db/development.sqlite3</code></div><div><br></div><div><code>&nbsp;Status &nbsp; Migration ID &nbsp; &nbsp;Migration Name</code></div><div><code>--------------------------------------------------</code></div><div><code>&nbsp; &nbsp;up &nbsp; &nbsp; 20140420172800 &nbsp;Create movies</code></div></div><div></div></div><div><br></div>Notez le mot "up" dans la colonne Status. Cela veux dire que la migration est effective.<div><br></div><div>
<p>A présent lancez à nouveau une migration en tapant&nbsp;: 
</p>
<div class="sites-codeblock sites-codesnippet-block"><code>rake </code><a href="javascript:void(0);"><code>db:migrate</code></a></div>
<p>Cette fois vous ne devriez voir aucune sortie. C'est parce que
toute les migrations ont déjà été lancées. 
</p>
<p>Pour l'instant, nous n'avons qu'une migration, mais dans les
exercices futurs nous en créerons d'autres.</p>
<h2><a name="TOC-3.-Cr-er-quelques-films."></a>3. Créer quelques films.</h2>
<p>A présent que nous avons la table «&nbsp;movies&nbsp;» et un
«&nbsp;movie_model.rb&nbsp;», nous pouvons utiliser le «&nbsp;model&nbsp;»
pour créer, lire, update, et supprimer des films. Nous n'avons pas
encore d'interface web pour ces opérations, aussi nous utiliserons
la console Rails à la place.</p>
<p>La console vous permet d'interagir en ligne de commande avec la
base de données de votre application. 
</p>
<p><b>1.</b>  Placer vous dans
votre dossier flix et lancez la session de console Rails en tapant&nbsp;:</p>
<div class="sites-codeblock sites-codesnippet-block"><p><code>rails console (ou rails c)</code></p>
</div>Une fois lancé vous afficherez
un prompt (nous afficherons
le prompt par &gt;&gt;, mais ne vous inquietez pas si le votre est
différents). 

<p>Vous êtes à présent dans une
session «&nbsp;irb&nbsp;», vous pouvez donc taper n'importe quelle
expressions Ruby.</p>
<p>Par exemple, tapez la commande
suivante pour avoir l'heure courante.</p>
<div class="sites-codeblock sites-codesnippet-block"><p><code>2.0.0-p353 :001 &gt; Time.now</code></p>
<p><code> =&gt; 2014-04-22 10:13:20 +0200</code></p></div>
<p>Notez que quand vous tapez
<b>Return</b>, l'expression
Ruby est évaluée et le résultat  est affiché sur la ligne  à la
suite de (=&gt;)</p>
<p>Ce qui est unique et très
puissant avec cette session «&nbsp;irb&nbsp;» est qu'elle charge
automatiquement l'environnement Rails.</p>
<p>Cela veut dire que vous pouvez
accéder aux composants de votre application  Rails, comme vos
«&nbsp;models&nbsp;», par exemple, continuez en tapant&nbsp;:</p>
<div class="sites-codeblock sites-codesnippet-block"><p><code>&gt;&gt;Movie.all</code></p>
</div>Vous de vriez avoir la sortie
suivante...
<div class="sites-codeblock sites-codesnippet-block"><p><code>2.0.0-p353 :002 &gt; Movie.all</code></p>
<p> <code>Movie Load (11.6ms)  SELECT
"movies".* FROM "movies"</code></p>
<p> <code>=&gt; #&lt;ActiveRecord::Relation
[]&gt; </code>
</p>
</div><div><br></div>Notez que la console affiche le
SQL qui a été exécuté. 

<p>Dans notre cas nous
avons appelé la méthode «&nbsp;all&nbsp;» et  Rails a généré
une requêtiee SQL «&nbsp;SELECT&nbsp;»&nbsp; qui a appelé tout les
films de la table&nbsp;«&nbsp;movies&nbsp;» de la base de données.

</p>
<p>Nous
n'avons aucun enregistrement de films dans notre base de données;
nous avons donc en retour un array (tableau) vide.
<i>ActiveRecord::Relation []</i></p><p><i><br></i></p><p>ActiveRecord : C'est quoi ?</p><p><b>ActiveRecord est l'outil qui permet à Rails d’interroger une base de données relationnelle (SQLite, mySQL, PostgreSQL...)&nbsp;</b></p><p><span style="font-size:10pt"><br></span></p><h2><a name="TOC-Cr-ons-le-premier-film"></a><font size="4">Créons le premier film</font></h2><div><b>1. </b>Commençons par fabriquer (instancier) un nouvel objet "Movie" en lui assignant une variable appelée "movie" que nous pourrons réutiliser plus tard.</div><div><br></div><div><div class="sites-codeblock sites-codesnippet-block"><code>&gt;&gt;movie = Movie.new</code></div></div><p><font size="3"><b>On appelle le Modele "Movie" et on lui affecte la méthode </b>ActiveRecord<b> .new</b></font></p><p><span style="font-size:10pt">Vous obtenez la sortie suivante</span></p><div class="sites-codeblock sites-codesnippet-block"><code>&nbsp;=&gt; #&lt;Movie id: nil, titre: nil, autorisation: nil, chiffre_affaire: nil, created_at: nil, updated_at: nil&gt;&nbsp;</code></div><p>Ahh, c'est intéressant ! Notez que ce nouvel objet a des attributs pour chaque colonne de la table "movies", les valeurs sont "nil", mais les attributs existent.</p><p>Retournons à la définition de la classe &nbsp;Movie dans le fichier <code>movie.rb<font face="arial, sans-serif">.</font></code></p><div class="sites-codeblock sites-codesnippet-block"><p><code>class Movie &lt; ActiveRecord::Base</code></p><p><code>end</code></p><div></div></div><div><br></div><div><b>On voit que la class Movie hérite de ActiveRecord.</b></div><div><b><br></b></div><div><b>ActiveRecord est un outil qui permet de travailer avec des bases de données relationelles.</b></div><div><b><br></b></div><div><b>Cela dit à Rails d'utiliser ActiveRecord pour travailler (create, read, update, read) avec la base de données).&nbsp;</b></div><div><b>ActiveRecord est activé par défaut en Rails. (Il y a d'autres outils outils ORM qui existent, mais bon...)&nbsp;</b></div><br><b>2.</b> Revenons à l'object movie dans la console; tout ses attributs ont actuellement la valeur "nil". Modifions cela en assignant une valeur à l'attribut "titre".</div><div><br></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>&gt;&gt;movie.titre = 'Iron Man' &nbsp;</code></div><div><div><span style="font-size:10pt"><code>&nbsp;=&gt; "Iron Man"&nbsp;</code></span></div></div><div></div></div><br><div>On affiche le titre en tapant:</div><div><br></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>&nbsp;movie.titre = 'Iron Man'</code></div><div><code>&nbsp;=&gt; "Iron Man"&nbsp;</code></div><div></div></div><span style="font-size:10pt">&nbsp;</span><div><b>3. </b>A présent assignons des valeurs à autorisation (string) et à chiffre_affaire (integer)</div><div><div><br></div><div></div></div><div class="sites-codeblock sites-codesnippet-block"><div><div><code>2.0.0-p353 :006 &gt; movie.autorisation = "Plus de 10 ans"</code></div><div><code>&nbsp;=&gt; "Plus de 10 ans"&nbsp;</code></div><div><code>2.0.0-p353 :007 &gt; movie.chiffre_affaire = 300000000</code></div><div><code>&nbsp;=&gt; 300000000&nbsp;</code></div></div><div></div></div><br><b>4. </b>&nbsp;Rappelez vous que nous avons ajouter avec la méthode .new la possibilité d'un nouvel enregistrement; cependant, il &nbsp;n'est pas actuellement réellement enregistré dans la base.<div>Pour cela, nous allons utiliser la méthode .save &nbsp;<br><br><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>&gt;&gt;movie.save</code></div><div><code>&nbsp; &nbsp;(0.3ms) &nbsp;begin transaction</code></div><div><code>&nbsp; SQL (60.3ms) &nbsp;INSERT INTO "movies" ("autorisation", "chiffre_affaire", "created_at", "titre", "updated_at") VALUES (?, ?, ?, ?, ?) &nbsp;[["autorisation", "Plus de 10 ans"], ["chiffre_affaire", 300000000], ["created_at", Tue, 22 Apr 2014 11:26:11 UTC +00:00], ["titre", "Iron Man"], ["updated_at", Tue, 22 Apr 2014 11:26:11 UTC +00:00]]</code></div><div><code>&nbsp; &nbsp;(142.5ms) &nbsp;commit transaction</code></div><div><code>&nbsp;=&gt; true&nbsp;</code></div><div></div></div><div><br></div><div>On peut afficher l'identifiant de l'enregistrement</div><br><div class="sites-codeblock sites-codesnippet-block"><div><code>&gt; movie.id</code></div><div><code>&nbsp;=&gt; 1</code></div></div><div><br></div><div>On peut afficher l'identifiant de la date de création</div><div><br></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>&gt; movie.created_at</code></div><div><code>&nbsp;=&gt; Tue, 22 Apr 2014 11:26:11 UTC +00:00&nbsp;</code></div><div></div></div><br>et de la date de modification<br><br><br><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>&gt; movie.updated_at</code></div><div><code>&nbsp;=&gt; Tue, 22 Apr 2014 11:44:58 UTC +00:00&nbsp;</code></div></div><div><br></div>Si on rappelle l'affichage de tout les films, on obtient un array (tableau)&nbsp;<br><br><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>&gt; Movie.all</code></div><div><code>&nbsp; Movie Load (0.5ms) &nbsp;SELECT "movies".* FROM "movies"</code></div><div><code>&nbsp;=&gt; #&lt;ActiveRecord::Relation [#&lt;Movie id: 1, titre: "Iron Man", autorisation: "Plus de 10 ans", chiffre_affaire: "300000000", created_at: "2014-04-22 11:26:11", updated_at: "2014-04-22 11:57:49"&gt;]&gt;&nbsp;</code></div></div><br></div><div>On peut aussi compter le nombre d'enregistrements.</div><div><br></div><div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>&gt; Movie.count</code></div><div><code>&nbsp; &nbsp;(0.2ms) &nbsp;SELECT COUNT(*) FROM "movies"</code></div><div><code>&nbsp;=&gt; 1&nbsp;</code></div></div></div><div><br></div><div>Afficher le premier enregistrement.</div><div><br></div><div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>&nbsp;&gt; Movie.first</code></div><div><code>&nbsp; Movie Load (0.3ms) &nbsp;SELECT "movies".* FROM "movies" ORDER BY "movies"."id" ASC LIMIT 1</code></div><div><code>&nbsp;=&gt; #&lt;Movie id: 1, titre: "Iron Man", autorisation: "Plus de 10 ans", chiffre_affaire: "300000000", created_at: "2014-04-22 11:26:11", updated_at: "2014-04-22 11:57:49"&gt;</code></div></div></div><div><br></div><div><br></div><h2><a name="TOC-Cr-er-un-second-film."></a>Créer un second film.</h2><div>Maintenant, utilisons ce que nous venons d'apprendre en créant un second film dans la base de données, mais en faisant légèrement différemment cette fois.&nbsp;</div><div><br></div><div>Pour créer notre premier film, nous avons utilisé la méthode .new à l'objet Movie et lui avons affecté des attributs (nom et valeur) de façon individuelle.</div><div><br></div><div>Cette fois, pour créer un second film, appelons la méthode .new et passons lui les attributs &nbsp;à la suite dans une table de hachage... (a hash) (en gros mettons les à la ligne les &nbsp;uns après les autres)</div><div><br></div><div><i>ATTENTION : ON NE PEUT PAS PASSER UN HASH&nbsp;<span style="font-size:10pt">DE LA MÊME FAÇON QU'</span><span style="font-size:10pt">EN PASSANT LES VALEURS INDIVIDUELLEMENT.&nbsp;</span></i></div><div><span style="font-size:10pt"><i>On ne peut pas faire m=Movie.new et m(titre: "superman", autorisation:"blablabla", chiifre_affaire=285000000)</i>.&nbsp;</span></div><div><br></div><div>ON NE PEUT PAS FAIRE NON PLUS</div><div><span style="font-size:10pt">&gt; Movie.new(titre: "Superman", autorisation: "Plus de 8 ans", chiffre_affaire: 285000000)</span></div><div>Même si le résultat est:<br> =&gt; #&lt;Movie id: nil, titre: "Superman", autorisation: "Plus de 8 ans", chiffre_affaire: 285000000, created_at: nil, updated_at: nil&gt;</div><div>Car dans ce cas on ne peut pas enregistrer les valeurs.<br>&nbsp; <div><span style="font-size:10pt">IL FAUT DÉCLARER UNE VARIABLE POUR ENSUITE POUVOIR AGIR DESSUS (.save)</span></div><div><div></div></div><div class="sites-codeblock sites-codesnippet-block"><div><div><code>movie=Movie.new(titre: "Superman", autorisation: "Plus de 8 ans", chiffre_affaire: 285000000)</code></div></div><div><code>=&gt; #&lt;Movie id: nil, titre: "Superman", autorisation: "Plus de 8 ans", chiffre_affaire: 285000000, created_at: nil, updated_at: nil&gt;</code></div></div><div><br></div><div><div>On remarque que les champs "id", "created_at" et "updated_at" sont "nil" pour l'instant. En effet, tant que l'on a pas utilisé la méthode .save à la classe Movie, les enregistremens ne sont pas enregistrés dans la table de la base de données. Donc il faut faire:</div></div><div><br></div><div><div class="sites-codeblock sites-codesnippet-block"><code>movie.save</code></div></div><div><br></div><div>qui donne</div><div><br></div><div><div></div></div><div class="sites-codeblock sites-codesnippet-block"><div><div><code>&nbsp;(30.7ms) &nbsp;begin transaction</code></div><div><code>&nbsp; SQL (538.3ms) &nbsp;INSERT INTO "movies" ("autorisation", "chiffre_affaire", "created_at", "titre", "updated_at") VALUES (?, ?, ?, ?, ?) &nbsp;[["autorisation", "Plus de 8 ans"], ["chiffre_affaire", 285000000], ["created_at", Tue, 22 Apr 2014 15:59:12 UTC +00:00], ["titre", "Superman"], ["updated_at", Tue, 22 Apr 2014 15:59:12 UTC +00:00]]</code></div><div><code>&nbsp; &nbsp;(158.7ms) &nbsp;commit transaction</code></div></div><div></div></div><div><br></div><div>On vérifie que les données sont bien passées en faisant:</div><div><br></div><div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>» &nbsp;Movie.all</code></div><div><code>&nbsp; Movie Load (1.9ms) &nbsp;SELECT "movies".* FROM "movies"</code></div><div><code>=&gt; #&lt;ActiveRecord::Relation [#&lt;Movie id: 1, titre: "Iron Man", autorisation: "Plus de 10 ans", chiffre_affaire: "300000000", created_at: "2014-04-22 11:26:11", updated_at: "2014-04-22 11:57:49"&gt;, #&lt;Movie id: 2, titre: "Superman", autorisation: "Plus de 8 ans", chiffre_affaire: "285000000", created_at: "2014-04-22 15:59:12", updated_at: "2014-04-22 15:59:12"&gt;]&gt;</code></div></div></div><div><br></div>Ok, tout est la. C'est bien, mais un peu difficile à lire...&nbsp;</div><div>On peut si on veut... installer une gem qui va nous améliorer ça. <a href="https://github.com/nixme/jazz_hands" target="_blank" rel="nofollow">Jazz_Hand</a>.</div><div><br></div><div>On ouvre le fichier flix/Gemfile.rb &nbsp;et on rajoute ce qui suit</div><div><br></div><div><div>###################</div><div># Gem rajoutée</div><div>gem 'jazz_hands'</div><div># jazz hand permet d'afficher de façon organisée les lignes de la consoles https://github.com/nixme/jazz_hands</div><div># faire rails c puis&nbsp;<span style="background-color:rgb(248,248,248);font-family:Consolas,Liberation Mono,Courier,monospace;font-size:12px;line-height:20.399999618530273px">Hirb.enable</span></div><div><br></div><div>&nbsp;&nbsp;</div><div># on peut en rajouter d'autres....</div><div><br></div><div><br></div><div>###################</div></div><div><br></div><div>On enregistre le fichier, on retourne dans le terminal dans le répertoire flix et on tape</div><div><br></div><div><div class="sites-codeblock sites-codesnippet-block"><code>bundle</code></div></div><div><br></div><div>On va sur la fenêtre du terminal de la console, on quitte la console</div><div><br></div><div><div class="sites-codeblock sites-codesnippet-block"><code>exit</code></div></div><div><br></div><div>On relance la console</div><div><br></div><div><div class="sites-codeblock sites-codesnippet-block"><code>rails c</code></div></div><div><br></div><div>Puis on tape</div><div><br></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><div>Hirb.enable</div></div></div><div><br></div><div>et enfin</div><div><br></div><div><div class="sites-codeblock sites-codesnippet-block"><code>Movie.all</code></div></div><div><br></div><div>Tadada</div><div><br></div><div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>Movie.all</code></div><div><code>&nbsp; Movie Load (1.9ms) &nbsp;SELECT "movies".* FROM "movies"</code></div><div><code>+----+----------+----------------+-----------------+-------------------------+-------------------------+</code></div><div><code>| id | titre &nbsp; &nbsp;| autorisation &nbsp; | chiffre_affaire | created_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| updated_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</code></div><div><code>+----+----------+----------------+-----------------+-------------------------+-------------------------+</code></div><div><code>| 1 &nbsp;| Iron Man | Plus de 10 ans | 300000000 &nbsp; &nbsp; &nbsp; | 2014-04-22 11:26:11 UTC | 2014-04-22 11:57:49 UTC |</code></div><div><code>| 2 &nbsp;| Superman | Plus de 8 ans &nbsp;| 285000000 &nbsp; &nbsp; &nbsp; | 2014-04-22 15:59:12 UTC | 2014-04-22 15:59:12 UTC |</code></div><div><code>+----+----------+----------------+-----------------+-------------------------+-------------------------+</code></div><div><code>2 rows in set</code></div></div></div><div><br></div><div><div><span style="font-size:10pt">C'est mieux et plus clair... N'est il pas ?</span></div><div><br></div><div><span style="font-size:10pt">A nouveau pour pratiquer, trouvons le dernier enregistrement.</span></div><div><br></div><div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>&nbsp;» &nbsp;Movie.last!</code></div><div><code>&nbsp; Movie Load (0.6ms) &nbsp;SELECT "movies".* FROM "movies" ORDER BY "movies"."id" DESC LIMIT 1</code></div><div><code>+----+----------+---------------+-----------------+-------------------------+-------------------------+</code></div><div><code>| id | titre &nbsp; &nbsp;| autorisation &nbsp;| chiffre_affaire | created_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| updated_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</code></div><div><code>+----+----------+---------------+-----------------+-------------------------+-------------------------+</code></div><div><code>| 2 &nbsp;| Superman | Plus de 8 ans | 285000000 &nbsp; &nbsp; &nbsp; | 2014-04-22 15:59:12 UTC | 2014-04-22 15:59:12 UTC |</code></div><div><code>+----+----------+---------------+-----------------+-------------------------+-------------------------+</code></div><div><code>1 row in set</code></div></div><div><br></div><b>Créons un troisième film</b></div><div>On crée</div><div><b><br></b></div><div><b><div></div></b><div class="sites-codeblock sites-codesnippet-block"><div><code>flix » &nbsp;movie=Movie.new(titre:"batman", autorisation:"Plus de 12 ans", chiffre_affaire:400000000)</code></div><div><code>+----+--------+----------------+-----------------+------------+------------+</code></div><div><code>| id | titre &nbsp;| autorisation &nbsp; | chiffre_affaire | created_at | updated_at |</code></div><div><code>+----+--------+----------------+-----------------+------------+------------+</code></div><div><code>| &nbsp; &nbsp;| batman | Plus de 12 ans | 400000000 &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</code></div><div><code>+----+--------+----------------+-----------------+------------+------------+</code></div><div><code>1 row in set</code></div></div><br>On enregistre</div><div><br></div><div><div style="line-height:13.333333015441895px"></div><div class="sites-codeblock sites-codesnippet-block"><div style="line-height:13.333333015441895px"><span style="color:rgb(0,96,0);font-size:10pt"><code>&nbsp;flix » &nbsp;movie.save</code></span></div><div style="line-height:13.333333015441895px"><code>&nbsp; &nbsp;(0.1ms) &nbsp;begin transaction</code></div><div style="line-height:13.333333015441895px"><code>&nbsp; SQL (43.0ms) &nbsp;INSERT INTO "movies" ("autorisation", "chiffre_affaire", "created_at", "titre", "updated_at") VALUES (?, ?, ?, ?, ?) &nbsp;[["autorisation", "Plus de 12 ans"], ["chiffre_affaire", 400000000], ["created_at", Tue, 22 Apr 2014 16:53:08 UTC +00:00], ["titre", "batman"], ["updated_at", Tue, 22 Apr 2014 16:53:08 UTC +00:00]]</code></div><div style="line-height:13.333333015441895px"><code>&nbsp; &nbsp;(152.9ms) &nbsp;commit transaction</code></div><div style="line-height:13.333333015441895px"><code>=&gt; true</code></div><div style="line-height:13.333333015441895px"></div></div><br><div style="line-height:13.333333015441895px"><font face="monospace" color="#000000">On affiche</font></div><div style="line-height:13.333333015441895px"><br></div><div style="line-height:13.333333015441895px"><div><div></div></div><div class="sites-codeblock sites-codesnippet-block"><div><div><code>flix » &nbsp;Movie.all</code></div><div><code>&nbsp; Movie Load (0.5ms) &nbsp;SELECT "movies".* FROM "movies"</code></div><div><code>+----+----------+----------------+-----------------+-------------------------+-------------------------+</code></div><div><code>| id | titre &nbsp; &nbsp;| autorisation &nbsp; | chiffre_affaire | created_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| updated_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</code></div><div><code>+----+----------+----------------+-----------------+-------------------------+-------------------------+</code></div><div><code>| 1 &nbsp;| Iron Man | Plus de 10 ans | 300000000 &nbsp; &nbsp; &nbsp; | 2014-04-22 11:26:11 UTC | 2014-04-22 11:57:49 UTC |</code></div><div><code>| 2 &nbsp;| Superman | Plus de 8 ans &nbsp;| 285000000 &nbsp; &nbsp; &nbsp; | 2014-04-22 15:59:12 UTC | 2014-04-22 15:59:12 UTC |</code></div><div><code>| 3 &nbsp;| batman &nbsp; | Plus de 12 ans | 400000000 &nbsp; &nbsp; &nbsp; | 2014-04-22 16:53:08 UTC | 2014-04-22 16:53:08 UTC |</code></div><div><code>+----+----------+----------------+-----------------+-------------------------+-------------------------+</code></div><div><code>3 rows in set</code></div></div><div></div></div><br><div><br></div><div><b>4.</b> Mettre à jour un film</div><div><br></div><div>Je viens de me rendre compte que j'ai écrit batman en oubliant de mettre une majuscule... Je dois donc le modifier...</div><div><br></div><div>La classe Movie hérite de nombreuses méthode (graçe à ActiveRecord). Par exemple, la méthode "find" prend un id comme paramètre et retourne et retourne le film de cette clé primaire.</div><div><br></div><div>Dans la console, trouvons le film "batman" en utilisant sa clé primaire.</div><div><br></div><div>On déclare une variable m qui est égale au film dont l'id est 3</div><div><br></div><div><div></div></div><div class="sites-codeblock sites-codesnippet-block"><div><div><code>&nbsp;m=Movie.find(3)</code></div><div><code>&nbsp; Movie Load (0.4ms) &nbsp;SELECT "movies".* FROM "movies" WHERE "movies"."id" = ? LIMIT 1 &nbsp;[["id", 3]]</code></div><div><code>+----+--------+----------------+-----------------+-------------------------+-------------------------+</code></div><div><code>| id | titre &nbsp;| autorisation &nbsp; | chiffre_affaire | created_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| updated_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</code></div><div><code>+----+--------+----------------+-----------------+-------------------------+-------------------------+</code></div><div><code>| 3 &nbsp;| batman | Plus de 12 ans | 400000000 &nbsp; &nbsp; &nbsp; | 2014-04-22 16:53:08 UTC | 2014-04-22 16:53:08 UTC |</code></div><div><code>+----+--------+----------------+-----------------+-------------------------+-------------------------+</code></div><div><code>1 row in set</code></div></div><div></div></div><div style="line-height:13.333333015441895px"><br></div>Puis on appelle le titre lié à cette variable</div><div style="line-height:13.333333015441895px"><br></div><div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><span style="line-height:13.333333015441895px"><code>&nbsp;» &nbsp;m.titre="Batman"</code></span></div><div><span style="line-height:13.333333015441895px"><code>=&gt; "Batman"</code></span></div><div style="line-height:13.333333015441895px"></div></div><br><div style="line-height:13.333333015441895px">Puis on sauvegarde</div><div style="line-height:13.333333015441895px"><br></div><div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><span style="line-height:13.333333015441895px"><code>» &nbsp;m.save</code></span></div><div><span style="line-height:13.333333015441895px"><code>&nbsp; &nbsp;(0.1ms) &nbsp;begin transaction</code></span></div><div><span style="line-height:13.333333015441895px"><code>&nbsp; SQL (0.4ms) &nbsp;UPDATE "movies" SET "titre" = ?, "updated_at" = ? WHERE "movies"."id" = 3 &nbsp;[["titre", "Batman"], ["updated_at", Tue, 22 Apr 2014 17:14:29 UTC +00:00]]</code></span></div><div><span style="line-height:13.333333015441895px"><code>&nbsp; &nbsp;(139.3ms) &nbsp;commit transaction</code></span></div><div><span style="line-height:13.333333015441895px"><code>=&gt; true</code></span></div></div><div style="line-height:13.333333015441895px"><br></div></div><div style="line-height:13.333333015441895px">A présent, on veut modifier le titre "Iron man" en "Iron man 2" et le chiffre d'affaire à 500000000 en une seule opération...</div><div style="line-height:13.333333015441895px"><br></div><div style="line-height:13.333333015441895px">On trouve le film</div><div style="line-height:13.333333015441895px"><br></div><div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><span style="line-height:13.333333015441895px"><code>&nbsp;» &nbsp;m=Movie.find(1)</code></span></div><div><span style="line-height:13.333333015441895px"><code>&nbsp; Movie Load (0.4ms) &nbsp;SELECT "movies".* FROM "movies" WHERE "movies"."id" = ? LIMIT 1 &nbsp;[["id", 1]]</code></span></div><div><span style="line-height:13.333333015441895px"><code>+----+----------+----------------+-----------------+-------------------------+-------------------------+</code></span></div><div><span style="line-height:13.333333015441895px"><code>| id | titre &nbsp; &nbsp;| autorisation &nbsp; | chiffre_affaire | created_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| updated_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</code></span></div><div><span style="line-height:13.333333015441895px"><code>+----+----------+----------------+-----------------+-------------------------+-------------------------+</code></span></div><div><span style="line-height:13.333333015441895px"><code>| 1 &nbsp;| Iron Man | Plus de 10 ans | 300000000 &nbsp; &nbsp; &nbsp; | 2014-04-22 11:26:11 UTC | 2014-04-22 11:57:49 UTC |</code></span></div><div><span style="line-height:13.333333015441895px"><code>+----+----------+----------------+-----------------+-------------------------+-------------------------+</code></span></div><div><span style="line-height:13.333333015441895px"><code>1 row in set</code></span></div><div style="line-height:13.333333015441895px"></div></div></div><div style="line-height:13.333333015441895px"><br></div><div style="line-height:13.333333015441895px">On utilise la méthode "update"</div><div style="line-height:13.333333015441895px"><br></div><div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><span style="color:rgb(0,96,0);font-family:monospace;line-height:1;font-size:10pt">flix »</span><span style="color:rgb(0,96,0);font-family:monospace;line-height:1;font-size:10pt">&nbsp;</span><span style="line-height:13.333333015441895px"><code>m.update(titre: "Iron Man 2", chiffre_affaire: 500000000)</code></span></div><div><span style="line-height:13.333333015441895px"><code>&nbsp; &nbsp;(0.1ms) &nbsp;begin transaction</code></span></div><div><span style="line-height:13.333333015441895px"><code>&nbsp; SQL (0.4ms) &nbsp;UPDATE "movies" SET "titre" = ?, "chiffre_affaire" = ?, "updated_at" = ? WHERE "movies"."id" = 1 &nbsp;[["titre", "Iron Man 2"], ["chiffre_affaire", 500000000], ["updated_at", Tue, 22 Apr 2014 17:23:44 UTC +00:00]]</code></span></div><div><span style="line-height:13.333333015441895px"><code>&nbsp; &nbsp;(164.6ms) &nbsp;commit transaction</code></span></div><div><span style="line-height:13.333333015441895px"><code>=&gt; true</code></span></div><div style="line-height:13.333333015441895px"></div></div><br></div><div>On vérifie que les données sont bien passées.</div><div><br></div><div><div></div></div><div class="sites-codeblock sites-codesnippet-block"><div><div><code>flix » &nbsp;m.titre</code></div><div><code>=&gt; "Iron Man 2"</code></div></div><div></div></div><div><br></div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>&nbsp;flix » &nbsp;m.chiffre_affaire</code></div><div><code>=&gt; 500000000</code></div><div></div></div><br><div style="line-height:13.333333015441895px">C'est bon !!</div><div style="line-height:13.333333015441895px"><br></div><div><span style="line-height:13.333333015441895px">La méthode "update" est très pratique, mais elle existe pour une raison encore plus importante</span><font size="2"><span style="line-height:13.333333015441895px">. Dans la&nbsp;</span></font><span style="line-height:13.333333015441895px">plupart des cas, vous&nbsp;créerez et mettrez à jour des enregistrement soumis dans un formulaire HTML.</span></div><div><span style="line-height:13.333333015441895px"><br></span></div><div><span style="line-height:13.333333015441895px">Quand le formulaire est soumis, les noms et les valeurs de ce formulaire sont capturés dans une table de hachage. Ce n'est donc pas une&nbsp;coïncidence si la méthode "update"</span><font size="2"><span style="line-height:13.333333015441895px">&nbsp;passe par une table de hachage d'attributs noms et valeurs... (exemple&nbsp;</span></font><span style="background-color:rgb(239,239,239);color:rgb(0,96,0);font-family:monospace;line-height:13.333333015441895px;font-size:10pt">[["titre", "Iron Man 2"], ["chiffre_affaire", 500000000]</span><span style="line-height:13.333333015441895px;font-size:small">)</span>&nbsp;</div><div><br></div><div><h2><a name="TOC-5.-Supprimer-un-film"></a><b>5. </b>Supprimer un film</h2><div>Finalement nous voulons supprimer un film de la base de données. Encore une fois l'héritage ActiveRecord du modèle Movie rend les choses vraiment simples.<br><br>Nous voulons supprimer "Superman" (ça lui apprendra...), mais nous ne connaissons pas l'id du film, il faut donc le retrouver par son nom.</div><div><br></div><div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>flix » &nbsp;m=Movie.find_by(titre:'Superman')</code></div><div><code>&nbsp; Movie Load (0.2ms) &nbsp;SELECT "movies".* FROM "movies" WHERE "movies"."titre" = 'Superman' LIMIT 1</code></div><div><code>+----+----------+---------------+-----------------+-------------------------+-------------------------+</code></div><div><code>| id | titre &nbsp; &nbsp;| autorisation &nbsp;| chiffre_affaire | created_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| updated_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</code></div><div><code>+----+----------+---------------+-----------------+-------------------------+-------------------------+</code></div><div><code>| 2 &nbsp;| Superman | Plus de 8 ans | 285000000 &nbsp; &nbsp; &nbsp; | 2014-04-22 15:59:12 UTC | 2014-04-22 15:59:12 UTC |</code></div><div><code>+----+----------+---------------+-----------------+-------------------------+-------------------------+</code></div><div><code>1 row in set</code></div></div></div><div><br></div><div>&nbsp;Puis on utilise la méthode "destroy" pour le supprimer...</div><div><br></div><div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>flix » &nbsp;m.destroy</code></div><div><code>&nbsp; &nbsp;(0.3ms) &nbsp;begin transaction</code></div><div><code>&nbsp; SQL (0.6ms) &nbsp;DELETE FROM "movies" WHERE "movies"."id" = ? &nbsp;[["id", 2]]</code></div><div><code>&nbsp; &nbsp;(153.8ms) &nbsp;commit transaction</code></div><div><code>+----+----------+---------------+-----------------+-------------------------+-------------------------+</code></div><div><code>| id | titre &nbsp; &nbsp;| autorisation &nbsp;| chiffre_affaire | created_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| updated_at &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</code></div><div><code>+----+----------+---------------+-----------------+-------------------------+-------------------------+</code></div><div><code>| 2 &nbsp;| Superman | Plus de 8 ans | 285000000 &nbsp; &nbsp; &nbsp; | 2014-04-22 15:59:12 UTC | 2014-04-22 15:59:12 UTC |</code></div><div><code>+----+----------+---------------+-----------------+-------------------------+-------------------------+</code></div><div><code>1 row in set</code></div><div></div></div><br>On peut vérifier que l'enregistrement a été supprimé.</div><div><br></div><div><div></div><div class="sites-codeblock sites-codesnippet-block"><div><code>flix » &nbsp;Movie.find_by(titre: 'Superman')</code></div><div><code>&nbsp; Movie Load (0.6ms) &nbsp;SELECT "movies".* FROM "movies" WHERE "movies"."titre" = 'Superman' LIMIT 1</code></div><div><code>=&gt; nil</code></div><div></div></div><br><br>On peut à présent sortir de la console en tapant exit ou ctrl D</div>
