<!DOCTYPE html>
<html lang="fr" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href='css/bootstrap.css' rel='stylesheet'>
<link rel="stylesheet" href="css/prism.css">
<title>0105_Rails_Connexion_du_MVC</title>


</head>
<body>
<div id="includedContent"></div>
<div class="container">
<div class="col-md-12">
<div class="row">
<h1>05 - Connexion du MVC</h1>

<p>A présent que nous avons enregistré les films dans la base de données et qu'un modèle «movie.rb » nous
    donne accès à ces derniers, il est temps de connecter le modèle au reste de l'application. Le but final
    est d'afficher une page listant les films enregistrés dans la base de données.</p>

<p>C'est un exercice rapide qui permet de rassembler la « triade » MVC.
    <ol>
<li>Connecter le modèle et le contrôleur</li>
<li>Pour se souvenir de ce que nous avons fait, retournons dans le navigateur à la page http://localhost:3000/movies. Vous devriez voir trois titres de film.</li>
</ol></p>

<p>Rappelez vous que nous avons écrit en dur ces titres dans un array (tableau) dans l'action index (def index) du fichier contrôleur « movies_controller.rb ».</p>
<pre><code class="language-ruby">def index
@movies = ['Iron Man', 'Superman', 'Spider-Man']
end</code></pre>

<p>Nous avons vu que nous pouvions interroger la base de données et afficher tout les film en tapant dans le
terminal "@movies =Movie.all"</p>

<p>Nous modifions l'action "index" en affectant à la variable "@movies" en écrivant à la place</p>

<pre><code class="language-ruby">def index
@movies = Movie.all
end</code></pre>

<p>Nous allons appeler cette action "index" dans la vue "index.html.erb" et affichons les valeurs pour chaque
film.</p>

<strong>Liste des films</strong>

    <pre><code class="language-ruby">@movies.each do |m| %>
    <%= m.titre> - <%= m.autorisation %> - <%= m.chiffre_affaire>
    end </code></pre>

    <p>A présent la liste des films s'affiche de façon dynamique.</p>
    <p> Cela veut dire que pour l'instant, nouspouvons créer, modifier, détruire des enregistrements dans la console (nous n'avons pas encore d'interface
web) et les lire le résultat sur la page web.</p>

<p>Faites des test dans la console... et rafraîchissez la page web...</p>

<strong>3. Juste pour flamber un peu formatons le chiffre d'affaire comme une monnaie (currency).</strong>

<p>Rails à une méthode de formatage de nombre qui s'appelle <code class="language-ruby">"number_to_currency"</code></p>


<pre><code class="language-ruby"><h1>Liste des films</h1>
    <@movies.each do |m| %>
<= m.titre> - <= m.autorisation> - <= number_to_currency(m.chiffre_affaire)>
        end
            </code></pre>
<p>On recharge la page web et ...</p>
Liste des films

Iron Man 2 - Plus de 10 ans - $500,000,000.00
Bat man - Plus de 12 ans - $400,000,000.00
Super Man - Plus de 8 ans - $600,000,000.00

    <p>C'est cool, mais c'est en dollar et formaté à l'américaine... :-( On va voir comment régler ça... c'est
pénible cette histoire...</p>

<p>On peut dans un premier temps faire ça...</p>

<pre><code class="language-ruby"><%= number_to_currency(m.chiffre_affaire,unit: "€", separator: ",", delimiter: "", format: "%n %u")></code> </pre>

<p>Mais bon...</p>

<strong>Conclusion</strong>

<p>Maintenant, vous avez un model, une vue et un controller fonctionnant en harmonie. Chaque composant a ses
propres responsabilités.</p>


Wrap Up

Now you have a model, view, and controller all working in harmony. Each component has its own
responsibilities:

The controller acts as a middleman. With one hand, it asks the model for application data (movies in this
case) and assigns the data to instance variables. With the other hand it tells a view template to display
the data in a view. Notice that the controller doesn't tell the model or view how to do their jobs.

The model provides convenient access to application-level data. In this case, our Movie model is connected
to a database table that contains movie information. The model completely encapsulates the lower-level
details of how each row of the database table is translated into a usable object. The model isn't concerned
with how the data will be used. Models can also define business logic (behavior) which we'll look at a bit
later.

The view is simply the presentation of data in an arbitrary format. In this case we used a view template to
generate an HTML view. The view doesn't concern itself with how the data it's displaying was assembled.

Here's the thing: It's easy to start adding code to a Rails project and impress your manager with the sheer
speed of Rails development. But before you put your hands on the keyboard, it's important to think about
where to add the code. Is it a model, view, or controller concern? Because if you start mixing the MVC
responsibilities, then you end up with an application that can be very difficult to change down the road.
And since change is inevitable, it's best if we're prepared for it. So as we move forward with adding more
features, we'll need to be mindful of separating the model, view, and controller concerns.

And on that note, in the next exercise we'll add a few more attributes to our Movie model. That change will
force us to think through the parts of MVC that are affected.


</div>
</div>

</div>

<!-- jQuery -->
<script src="js/jquery-1.11.3.js"></script>
<script>
$(document).ready(function () {
$("#includedContent").load("nav.html");
});
</script>
<!-- Bootstrap JavaScript -->

<script src="js/bootstrap.min.js"></script>
<script src="js/prism.js"></script>

</body>
</html>
